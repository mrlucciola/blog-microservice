import axios from "axios";
// state
import { makeAutoObservable } from "mobx";
// stores
import { RootStore } from "./rootStore";
// models
import { PostListProps, PostProps } from "../../components/PostView/PostList";
import { PORT_QUERY } from "../../constants";

/// Main
export class MainStore {
  // ctor
  constructor(_rootStore: RootStore) {
    // this.other = rootStore.other
    makeAutoObservable(this, {}, { autoBind: true });
  }

  /////////////////////////////////////////////////////////
  ////////////////////// OBSERVABLES //////////////////////
  posts: PostProps[] = [];
  ////////////////////// OBSERVABLES //////////////////////
  /////////////////////////////////////////////////////////

  /////////////////////////////////////////////////////////
  /////////////////////// COMPUTEDS ///////////////////////
  /////////////////////// COMPUTEDS ///////////////////////
  /////////////////////////////////////////////////////////

  /////////////////////////////////////////////////////////
  //////////////////////// ACTIONS ////////////////////////
  setPosts = (newPostsArr: PostProps[]) => {
    this.posts = newPostsArr;
  };
  postsPush = (newPost: PostProps) => {
    this.posts.push(newPost);
  };
  postsFilterOne = (postToRemove: PostProps) => {
    this.posts = this.posts.filter((post) => {
      return post.id !== postToRemove.id;
    });
  };
  postsFetch = async () => {
    const res = await axios.get<PostListProps>(
      `http://localhost:${PORT_QUERY}/posts`
    );
    if (res.data) this.setPosts(Object.values(res.data));
  };
  //////////////////////// ACTIONS ////////////////////////
  /////////////////////////////////////////////////////////

  /////////////////////////////////////////////////////////
  //////////////////////// HELPERS ////////////////////////
  //////////////////////// HELPERS ////////////////////////
  /////////////////////////////////////////////////////////
}
